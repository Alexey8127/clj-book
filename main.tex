
\documentclass[$FONT $DRAFT]{$DOCUMENT} % ,draft

\usepackage{tikz}
\usepackage{tocloft}
\usepackage{geometry}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}

% for proper ' and `
\usepackage{textcomp}
\usepackage{upquote}

% to replace strings
\usepackage{xstring}

% extra space at the end of macros
\usepackage{xspace}

% const
\def\empty{\xspace}
\def\print{print}
\def\ebook{ebook}

% env vars
\def\domain{$DOMAIN}
\def\email{$EMAIL}
\def\publisher{$PUBLISHER\xspace}
\def\commithash{$COMMIT_HASH\xspace}
\def\committs{$COMMIT_TS\xspace}
\def\mode{$MODE}

% http://www.khirevich.com/latex/microtype/
\usepackage[
  activate={true, nocompatibility},
  final,
  tracking=true,
  kerning=true,
  spacing=true,
  factor=1100,
  stretch=10,
  shrink=10
]{microtype}

% better captions
\usepackage[font=small]{caption}

\captionsetup[listing]{name=Листинг}

% wavy lines
\usepackage[normalem]{ulem}

% for QR codes in
\usepackage{qrcode}

% to have bold tt fonts in code listings
\usepackage{bold-extra}

% better macro args
\usepackage{xparse}

% better margin notes
\usepackage{marginnote}

% file trees
\usepackage{dirtree}
\input{DT}

\usepackage[newfloat=true]{minted}

\ifx\mode\print
\usemintedstyle{print}
\fi

\ifx\mode\ebook
\usemintedstyle{default}
\fi

\SetupFloatingEnvironment{listing}{placement=H}

% index
\usepackage{index}
\newindex{default}{idx}{ind}{Предметный указатель}
\usepackage[
  unbalanced,
  itemlayout=abshang,
  indentunit=0.25em,
  totoc
]{idxlayout}

\usepackage{setspace}

\ifx\mode\print
\else
\usepackage[hidelinks]{hyperref}
%% \hypersetup{colorlinks=false}
\fi

%% geometry presets
\input{$GEOMTRY}

%% debug frames
%% \geometry{showframe}

\setlength{\parskip}{0.32em}

\pagestyle{plain}
\pagenumbering{arabic}

\setcounter{tocdepth}{1}

\widowpenalty=10000
\clubpenalty=10000
\tolerance=500
\hyphenpenalty=500
\hfuzz=0.5pt
\emergencystretch=5pt

\input{charts}
\input{macro}

\author{Иван Гришаев}
\title{Clojure на производстве}
\date{}

\begin{document}

\input{hyphenation}

\input{title}

\input{abstract}

%% https://tex.stackexchange.com/questions/41555/
\cleardoublepage
\tableofcontents

\clearpage
\input{about}

%% \blank\include{ch1-web}
%% \blank\include{ch2-spec}
%% \blank\include{ch3-exceptions}
%% \blank\include{ch4-mutability}
%% \blank\include{ch5-config}
%% \blank\include{ch6-systems}
%% \blank\include{ch7-tests}

\ifx\mode\print
\backmatter
\fi

\include{afterword}

% https://tex.stackexchange.com/questions/203720/
\makeatletter\@openrightfalse\makeatother
\printindex

\input{exit}

\end{document}
